<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>تبدیل متن به ویدیو با عکس واقعی، صدا و اسلایدشو حرفه‌ای</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            background: linear-gradient(135deg, #0c0c2e, #1a1a3e);
            color: #fff;
            min-height: 100vh;
            padding: 15px;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 100%;
            margin: 0 auto;
            padding: 15px;
        }
        
        @media (min-width: 768px) {
            .container {
                max-width: 800px;
            }
        }
        
        @media (min-width: 1200px) {
            .container {
                max-width: 1000px;
            }
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }
        
        h1 {
            font-size: 2rem;
            margin-bottom: 10px;
            background: linear-gradient(to right, #ff6b6b, #4ecdc4, #45b7d1);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }
        
        @media (min-width: 768px) {
            h1 {
                font-size: 2.5rem;
            }
        }
        
        .subtitle {
            font-size: 1rem;
            color: #a0c8ff;
            margin-bottom: 15px;
        }
        
        @media (min-width: 768px) {
            .subtitle {
                font-size: 1.1rem;
            }
        }
        
        .main-content {
            display: flex;
            flex-direction: column;
            gap: 25px;
            margin-bottom: 30px;
        }
        
        @media (min-width: 992px) {
            .main-content {
                flex-direction: row;
            }
        }
        
        .input-section, .preview-section {
            flex: 1;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
        }
        
        .section-title {
            font-size: 1.3rem;
            margin-bottom: 15px;
            color: #4ecdc4;
            display: flex;
            align-items: center;
            gap: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .section-title i {
            font-size: 1.2rem;
        }
        
        textarea {
            width: 100%;
            height: 150px;
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            color: white;
            font-size: 1rem;
            padding: 15px;
            resize: vertical;
            margin-bottom: 15px;
            transition: all 0.3s;
        }
        
        textarea:focus {
            outline: none;
            border-color: #4ecdc4;
            background: rgba(255, 255, 255, 0.12);
            box-shadow: 0 0 15px rgba(78, 205, 196, 0.3);
        }
        
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-bottom: 20px;
        }
        
        .control-group {
            flex: 1;
            min-width: calc(50% - 12px);
        }
        
        label {
            display: block;
            margin-bottom: 6px;
            color: #a0c8ff;
            font-size: 0.9rem;
        }
        
        select, input {
            width: 100%;
            padding: 10px;
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: white;
            font-size: 0.9rem;
            transition: all 0.3s;
        }
        
        select:focus, input:focus {
            outline: none;
            border-color: #4ecdc4;
            box-shadow: 0 0 10px rgba(78, 205, 196, 0.2);
        }
        
        select option {
            background: #0c0c2e;
        }
        
        .upload-section {
            margin: 15px 0;
            padding: 15px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            border: 2px dashed rgba(255, 255, 255, 0.2);
        }
        
        .upload-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            border: 2px dashed #4ecdc4;
        }
        
        .upload-btn:hover {
            background: rgba(78, 205, 196, 0.1);
            transform: translateY(-3px);
        }
        
        .upload-btn i {
            font-size: 2rem;
            color: #4ecdc4;
            margin-bottom: 10px;
        }
        
        .upload-btn span {
            font-size: 0.9rem;
            color: #a0c8ff;
        }
        
        #uploadInput, #audioInput, #multipleImagesInput {
            display: none;
        }
        
        .upload-preview {
            margin-top: 15px;
            display: none;
        }
        
        .upload-preview img, .upload-preview audio {
            width: 100%;
            border-radius: 10px;
            border: 2px solid #4ecdc4;
        }
        
        .upload-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 10px;
        }
        
        .remove-upload {
            background: rgba(255, 107, 107, 0.2);
            color: #ff6b6b;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.3s;
        }
        
        .remove-upload:hover {
            background: rgba(255, 107, 107, 0.3);
        }
        
        .background-gallery {
            margin-top: 15px;
        }
        
        .gallery-title {
            font-size: 1.1rem;
            margin-bottom: 12px;
            color: #4ecdc4;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .gallery-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(70px, 1fr));
            gap: 8px;
            max-height: 250px;
            overflow-y: auto;
            padding: 10px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            margin-bottom: 12px;
        }
        
        @media (min-width: 768px) {
            .gallery-container {
                grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
                max-height: 300px;
            }
        }
        
        .background-thumb {
            width: 100%;
            height: 60px;
            border-radius: 8px;
            cursor: pointer;
            object-fit: cover;
            transition: all 0.3s;
            border: 2px solid transparent;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.4);
        }
        
        .background-thumb:hover {
            transform: scale(1.08);
            border-color: #4ecdc4;
            box-shadow: 0 5px 15px rgba(78, 205, 196, 0.5);
        }
        
        .background-thumb.selected {
            border-color: #ff6b6b;
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.6);
            transform: scale(1.05);
        }
        
        .selected-bg-info {
            background: rgba(255, 107, 107, 0.1);
            padding: 10px;
            border-radius: 8px;
            margin-top: 10px;
            text-align: center;
            font-size: 0.85rem;
            border: 1px solid rgba(255, 107, 107, 0.2);
        }
        
        .audio-section {
            margin: 20px 0;
            padding: 15px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            border: 2px dashed rgba(255, 107, 107, 0.3);
        }
        
        .audio-section .upload-btn {
            border-color: #ff6b6b;
        }
        
        .audio-section .upload-btn i {
            color: #ff6b6b;
        }
        
        .buttons {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 20px;
        }
        
        @media (min-width: 480px) {
            .buttons {
                flex-direction: row;
            }
        }
        
        .btn {
            flex: 1;
            padding: 14px 20px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            min-height: 50px;
        }
        
        .btn-primary {
            background: linear-gradient(to right, #ff6b6b, #ff8e8e);
            color: white;
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);
        }
        
        .btn-primary:hover:not(:disabled) {
            background: linear-gradient(to right, #ff5252, #ff7b7b);
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(255, 107, 107, 0.6);
        }
        
        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-3px);
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }
        
        .video-container {
            width: 100%;
            background: #000;
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 20px;
            position: relative;
            min-height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            border: 2px solid rgba(255, 255, 255, 0.1);
        }
        
        @media (min-width: 768px) {
            .video-container {
                min-height: 350px;
            }
        }
        
        canvas {
            width: 100%;
            height: auto;
            max-height: 350px;
            background: #000;
            display: block;
        }
        
        .timer {
            position: absolute;
            top: 12px;
            right: 12px;
            background: rgba(0, 0, 0, 0.7);
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.9rem;
            z-index: 10;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }
        
        .loading-spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid #ff6b6b;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .info-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 20px;
            margin-top: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .info-title {
            font-size: 1.2rem;
            margin-bottom: 12px;
            color: #4ecdc4;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .info-list {
            list-style-type: none;
            padding-right: 20px;
        }
        
        .info-list li {
            margin-bottom: 10px;
            padding-right: 10px;
            position: relative;
            font-size: 0.9rem;
            line-height: 1.5;
        }
        
        .info-list li:before {
            content: "•";
            color: #ff6b6b;
            font-size: 1.5rem;
            position: absolute;
            right: -20px;
            top: -3px;
        }
        
        .instructions {
            font-size: 0.85rem;
            color: #a0c8ff;
            margin-top: 10px;
            text-align: center;
        }
        
        .social-badges {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .social-badge {
            background: rgba(255, 255, 255, 0.1);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 8px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .background-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding-bottom: 10px;
        }
        
        .tab-btn {
            padding: 8px 15px;
            background: rgba(255, 255, 255, 0.05);
            border: none;
            border-radius: 8px;
            color: #a0c8ff;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .tab-btn.active {
            background: rgba(78, 205, 196, 0.2);
            color: #4ecdc4;
        }
        
        .tab-btn:hover:not(.active) {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .duration-control {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }
        
        .duration-value {
            font-size: 0.9rem;
            color: #4ecdc4;
            font-weight: bold;
            min-width: 40px;
            text-align: center;
        }
        
        /* اسلایدشو جدید */
        .slideshow-controls {
            margin-top: 15px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
        }
        
        .slideshow-title {
            font-size: 1.1rem;
            margin-bottom: 10px;
            color: #4ecdc4;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .slideshow-sliders {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .slider-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .slider-group label {
            min-width: 100px;
            margin: 0;
        }
        
        .slider-value {
            min-width: 40px;
            text-align: center;
            font-weight: bold;
            color: #4ecdc4;
        }
        
        .images-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(70px, 1fr));
            gap: 8px;
            max-height: 200px;
            overflow-y: auto;
            padding: 10px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            margin-top: 10px;
        }
        
        .image-item {
            position: relative;
            border-radius: 8px;
            overflow: hidden;
            aspect-ratio: 4/3;
        }
        
        .image-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .image-remove {
            position: absolute;
            top: 5px;
            left: 5px;
            background: rgba(255, 107, 107, 0.8);
            border: none;
            color: white;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }
        
        .multi-upload-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            border: 2px dashed #ff6b6b;
            grid-column: 1 / -1;
        }
        
        .multi-upload-btn:hover {
            background: rgba(255, 107, 107, 0.1);
            transform: translateY(-3px);
        }
        
        .multi-upload-btn i {
            font-size: 1.5rem;
            color: #ff6b6b;
            margin-bottom: 8px;
        }
        
        .multi-upload-btn span {
            font-size: 0.8rem;
            color: #a0c8ff;
        }
        
        .progress-bar {
            width: 100%;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            margin-top: 10px;
            overflow: hidden;
            display: none;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(to right, #4ecdc4, #45b7d1);
            width: 0%;
            transition: width 0.3s;
        }
        
        /* تنظیمات کیفیت */
        .quality-controls {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }
        
        .quality-btn {
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: #a0c8ff;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.85rem;
        }
        
        .quality-btn.active {
            background: rgba(78, 205, 196, 0.2);
            color: #4ecdc4;
            border-color: #4ecdc4;
        }
        
        .quality-btn:hover:not(.active) {
            background: rgba(255, 255, 255, 0.1);
        }
        
        @media (max-width: 768px) {
            textarea, select, input, button {
                font-size: 16px !important;
            }
        }
        
        .text-controls {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }
        
        .text-toggle {
            padding: 8px 15px;
            background: rgba(255, 107, 107, 0.1);
            border: 1px solid rgba(255, 107, 107, 0.3);
            border-radius: 8px;
            color: #ff6b6b;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s;
        }
        
        .text-toggle.active {
            background: rgba(78, 205, 196, 0.2);
            color: #4ecdc4;
            border-color: #4ecdc4;
        }
        
        .text-toggle:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .text-hint {
            font-size: 0.8rem;
            color: #a0c8ff;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-video"></i> تبدیل متن به ویدیو حرفه‌ای</h1>
            <p class="subtitle">با عکس‌های واقعی، امکان صداگذاری و ساخت اسلایدشو</p>
            
            <div class="social-badges">
                <div class="social-badge">
                    <i class="fas fa-image" style="color: #4ecdc4;"></i>
                    ۵۰ عکس واقعی
                </div>
                <div class="social-badge">
                    <i class="fas fa-music" style="color: #ff6b6b;"></i>
                    صداگذاری
                </div>
                <div class="social-badge">
                    <i class="fas fa-sliders-h" style="color: #ffd93d;"></i>
                    اسلایدشو
                </div>
                <div class="social-badge">
                    <i class="fas fa-hd" style="color: #45b7d1;"></i>
                    کیفیت 4K
                </div>
            </div>
        </header>
        
        <div class="main-content">
            <section class="input-section">
                <h2 class="section-title"><i class="fas fa-edit"></i> متن و تنظیمات</h2>
                
                <textarea id="textInput" placeholder="متن خود را اینجا وارد کنید یا خالی بگذارید..."></textarea>
                
                <div class="text-controls">
                    <button class="text-toggle active" id="textToggle">
                        <i class="fas fa-font"></i> نمایش متن در ویدیو
                    </button>
                    <span class="text-hint">اگر متن وارد نکنید، فقط عکس‌ها نمایش داده می‌شوند</span>
                </div>
                
                <div class="controls">
                    <div class="control-group">
                        <label for="fontSize"><i class="fas fa-text-height"></i> اندازه فونت</label>
                        <select id="fontSize">
                            <option value="48">خیلی بزرگ</option>
                            <option value="42">بزرگ</option>
                            <option value="36" selected>متوسط</option>
                            <option value="32">کوچک</option>
                            <option value="28">خیلی کوچک</option>
                        </select>
                    </div>
                    
                    <div class="control-group">
                        <label for="textColor"><i class="fas fa-palette"></i> رنگ متن</label>
                        <select id="textColor">
                            <option value="#ffffff" selected>سفید</option>
                            <option value="#ff6b6b">قرمز</option>
                            <option value="#4ecdc4">فیروزه‌ای</option>
                            <option value="#45b7d1">آبی آسمانی</option>
                            <option value="#96ceb4">سبز</option>
                            <option value="#ffd93d">زرد</option>
                            <option value="#ff9ff3">صورتی</option>
                            <option value="#feca57">طلایی</option>
                        </select>
                    </div>
                    
                    <div class="control-group">
                        <label for="textEffect"><i class="fas fa-magic"></i> افکت متن</label>
                        <select id="textEffect">
                            <option value="shadow" selected>سایه دار</option>
                            <option value="glow">درخشان</option>
                            <option value="gradient">گرادیان</option>
                            <option value="outline">حاشیه دار</option>
                            <option value="3d">سه بعدی</option>
                        </select>
                    </div>
                    
                    <div class="control-group">
                        <label for="duration"><i class="fas fa-clock"></i> مدت ویدیو (ثانیه)</label>
                        <div class="duration-control">
                            <input type="range" id="duration" min="5" max="600" value="15" step="1">
                            <span class="duration-value" id="durationValue">15</span>
                        </div>
                    </div>
                </div>
                
                <!-- بخش کیفیت -->
                <div class="slideshow-controls">
                    <h3 class="slideshow-title"><i class="fas fa-hd"></i> تنظیمات کیفیت ویدیو</h3>
                    
                    <div class="quality-controls">
                        <button class="quality-btn active" data-quality="720">HD 720p</button>
                        <button class="quality-btn" data-quality="1080">Full HD 1080p</button>
                        <button class="quality-btn" data-quality="1440">2K 1440p</button>
                        <button class="quality-btn" data-quality="2160">4K 2160p</button>
                    </div>
                    
                    <div class="slideshow-sliders" style="margin-top: 15px;">
                        <div class="slider-group">
                            <label for="fpsRate">فریم بر ثانیه:</label>
                            <select id="fpsRate">
                                <option value="24">24 FPS (فیلمی)</option>
                                <option value="30" selected>30 FPS (استاندارد)</option>
                                <option value="60">60 FPS (نرم)</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <!-- بخش اسلایدشو -->
                <div class="slideshow-controls">
                    <h3 class="slideshow-title"><i class="fas fa-sliders-h"></i> تنظیمات اسلایدشو</h3>
                    
                    <div class="slideshow-sliders">
                        <div class="slider-group">
                            <label for="transitionDuration">مدت هر عکس:</label>
                            <input type="range" id="transitionDuration" min="1" max="10" value="3" step="0.5">
                            <span class="slider-value" id="transitionDurationValue">3 ثانیه</span>
                        </div>
                        
                        <div class="slider-group">
                            <label for="transitionEffect">افکت انتقال:</label>
                            <select id="transitionEffect">
                                <option value="fade">محو شدن</option>
                                <option value="slide" selected>لغزش</option>
                                <option value="zoom">زوم</option>
                                <option value="pan">حرکت</option>
                                <option value="none">بدون افکت</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="multi-upload-btn" id="multiUploadTrigger">
                        <i class="fas fa-layer-group"></i>
                        <span>برای آپلود چند عکس کلیک کنید</span>
                        <span style="font-size: 0.7rem; margin-top: 5px; color: #888;">حداکثر ۲۰ عکس</span>
                    </div>
                    <input type="file" id="multipleImagesInput" accept="image/*" multiple>
                    
                    <div class="images-container" id="multipleImagesContainer">
                        <!-- عکس‌های آپلود شده اینجا نمایش داده می‌شوند -->
                    </div>
                </div>
                
                <!-- بخش صداگذاری -->
                <div class="audio-section">
                    <h3 class="gallery-title"><i class="fas fa-music"></i> افزودن صدا به ویدیو (اختیاری)</h3>
                    <div class="upload-btn" id="audioTrigger">
                        <i class="fas fa-file-audio"></i>
                        <span>برای آپلود فایل صوتی کلیک کنید</span>
                        <span style="font-size: 0.8rem; margin-top: 5px; color: #888;">فرمت‌های مجاز: MP3, WAV, OGG</span>
                    </div>
                    <input type="file" id="audioInput" accept="audio/*">
                    
                    <div class="upload-preview" id="audioPreview">
                        <audio id="uploadedAudio" controls></audio>
                        <div class="upload-info">
                            <span id="audioFileName">فایل صوتی</span>
                            <button class="remove-upload" id="removeAudio">
                                <i class="fas fa-trash"></i> حذف
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="background-gallery">
                    <div class="background-tabs">
                        <button class="tab-btn active" data-tab="gallery">
                            <i class="fas fa-images"></i> گالری عکس‌های واقعی
                        </button>
                        <button class="tab-btn" data-tab="upload">
                            <i class="fas fa-upload"></i> آپلود عکس
                        </button>
                    </div>
                    
                    <div class="tab-content active" id="gallery-tab">
                        <h3 class="gallery-title"><i class="fas fa-paw"></i> ۵۰ عکس واقعی از طبیعت و حیوانات</h3>
                        <div class="gallery-container" id="backgroundGallery">
                            <!-- تصاویر واقعی در اینجا اضافه می‌شوند -->
                        </div>
                    </div>
                    
                    <div class="tab-content" id="upload-tab">
                        <div class="upload-section">
                            <div class="upload-btn" id="uploadTrigger">
                                <i class="fas fa-cloud-upload-alt"></i>
                                <span>برای آپلود عکس کلیک کنید</span>
                                <span style="font-size: 0.8rem; margin-top: 5px; color: #888;">فرمت‌های مجاز: JPG, PNG, WebP</span>
                            </div>
                            <input type="file" id="uploadInput" accept="image/*">
                            
                            <div class="upload-preview" id="uploadPreview">
                                <img id="uploadedImage" alt="عکس آپلود شده">
                                <div class="upload-info">
                                    <span id="uploadFileName">عکس انتخابی</span>
                                    <button class="remove-upload" id="removeUpload">
                                        <i class="fas fa-trash"></i> حذف
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="selected-bg-info" id="selectedBgInfo">
                        در حال بارگذاری ۵۰ عکس واقعی از طبیعت و حیوانات...
                    </div>
                </div>
                
                <div class="progress-bar" id="progressBarContainer">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                
                <div class="buttons">
                    <button id="generateBtn" class="btn btn-primary">
                        <i class="fas fa-play-circle"></i> ایجاد ویدیو
                    </button>
                    <button id="downloadBtn" class="btn btn-secondary" disabled>
                        <i class="fas fa-download"></i> دانلود ویدیو
                    </button>
                </div>
                
                <div class="loading" id="loadingIndicator">
                    <div class="loading-spinner"></div>
                    <p id="loadingText">در حال ساخت ویدیو حرفه‌ای...</p>
                    <p id="loadingDetails">لطفا صبر کنید...</p>
                </div>
            </section>
            
            <section class="preview-section">
                <h2 class="section-title"><i class="fas fa-eye"></i> پیش‌نمایش ویدیو</h2>
                
                <div class="video-container">
                    <canvas id="videoCanvas" width="1920" height="1080"></canvas>
                    <div class="timer" id="timer">00:00 / 00:15</div>
                    
                    <div id="canvasPlaceholder">
                        <p style="color: #aaa; font-size: 1rem; text-align: center; padding: 20px;">
                            <i class="fas fa-video" style="font-size: 2rem; margin-bottom: 10px; display: block;"></i>
                            ویدیوی شما اینجا نمایش داده می‌شود
                        </p>
                    </div>
                </div>
                
                <div class="instructions">
                    <p><i class="fas fa-info-circle"></i> کیفیت ویدیو: تا 4K • حداکثر مدت: 10 دقیقه • با صدا • فرمت: MP4</p>
                    <p><i class="fas fa-exclamation-triangle"></i> هرچه کیفیت بالاتر باشد، زمان ساخت بیشتر طول می‌کشد</p>
                </div>
            </section>
        </div>
        
        <section class="info-section">
            <h3 class="info-title"><i class="fas fa-lightbulb"></i> راهنمای کامل ساخت ویدیو حرفه‌ای</h3>
            <ul class="info-list">
                <li><strong>متن دلخواه (اختیاری):</strong> اگر می‌خواهید متن در ویدیو نمایش داده شود، آن را تایپ کنید</li>
                <li><strong>تنظیم کیفیت:</strong> کیفیت ویدیو را از 720p تا 4K انتخاب کنید</li>
                <li><strong>آپلود چند عکس:</strong> تا 20 عکس آپلود کنید تا اسلایدشو بسازید</li>
                <li><strong>تنظیم مدت زمان:</strong> با اسلایدر مدت ویدیو را از 5 تا 600 ثانیه تنظیم کنید</li>
                <li><strong>انتخاب پس‌زمینه:</strong> از 50 عکس واقعی حیوانات و طبیعت انتخاب کنید یا عکس خود را آپلود کنید</li>
                <li><strong>افزودن صدا (اختیاری):</strong> فایل صوتی MP3, WAV یا OGG آپلود کنید تا روی ویدیو پخش شود</li>
                <li><strong>تنظیمات متن:</strong> اندازه، رنگ و افکت متن را تنظیم کنید</li>
                <li><strong>ایجاد ویدیو:</strong> روی دکمه "ایجاد ویدیو" کلیک کنید تا ویدیو با صدا ساخته شود</li>
                <li><strong>دانلود:</strong> ویدیوی نهایی را با کیفیت انتخابی دانلود کنید</li>
            </ul>
        </section>
    </div>

    <script>
        // عناصر DOM
        const textInput = document.getElementById('textInput');
        const textToggle = document.getElementById('textToggle');
        const fontSizeSelect = document.getElementById('fontSize');
        const textColorSelect = document.getElementById('textColor');
        const textEffectSelect = document.getElementById('textEffect');
        const durationSlider = document.getElementById('duration');
        const durationValue = document.getElementById('durationValue');
        const generateBtn = document.getElementById('generateBtn');
        const downloadBtn = document.getElementById('downloadBtn');
        const videoCanvas = document.getElementById('videoCanvas');
        const timer = document.getElementById('timer');
        const loadingIndicator = document.getElementById('loadingIndicator');
        const loadingText = document.getElementById('loadingText');
        const loadingDetails = document.getElementById('loadingDetails');
        const canvasPlaceholder = document.getElementById('canvasPlaceholder');
        const backgroundGallery = document.getElementById('backgroundGallery');
        const selectedBgInfo = document.getElementById('selectedBgInfo');
        
        // عناصر جدید برای اسلایدشو
        const multipleImagesInput = document.getElementById('multipleImagesInput');
        const multiUploadTrigger = document.getElementById('multiUploadTrigger');
        const multipleImagesContainer = document.getElementById('multipleImagesContainer');
        const transitionDurationSlider = document.getElementById('transitionDuration');
        const transitionDurationValue = document.getElementById('transitionDurationValue');
        const transitionEffectSelect = document.getElementById('transitionEffect');
        const progressBarContainer = document.getElementById('progressBarContainer');
        const progressFill = document.getElementById('progressFill');
        
        // عناصر کیفیت
        const qualityBtns = document.querySelectorAll('.quality-btn');
        const fpsRateSelect = document.getElementById('fpsRate');
        
        // عناصر آپلود
        const uploadInput = document.getElementById('uploadInput');
        const uploadTrigger = document.getElementById('uploadTrigger');
        const uploadPreview = document.getElementById('uploadPreview');
        const uploadedImage = document.getElementById('uploadedImage');
        const uploadFileName = document.getElementById('uploadFileName');
        const removeUpload = document.getElementById('removeUpload');
        
        // عناصر صدا
        const audioInput = document.getElementById('audioInput');
        const audioTrigger = document.getElementById('audioTrigger');
        const audioPreview = document.getElementById('audioPreview');
        const uploadedAudio = document.getElementById('uploadedAudio');
        const audioFileName = document.getElementById('audioFileName');
        const removeAudio = document.getElementById('removeAudio');
        
        // عناصر تب‌ها
        const tabButtons = document.querySelectorAll('.tab-btn');
        const tabContents = document.querySelectorAll('.tab-content');
        
        // متغیرهای انیمیشن
        let animationId = null;
        let mediaRecorder = null;
        let recordedChunks = [];
        let startTime = null;
        let isGenerating = false;
        let ctx = videoCanvas.getContext('2d', { alpha: false });
        let selectedBackground = null;
        let backgroundImages = [];
        let loadedImages = 0;
        let userUploadedImage = null;
        let userUploadedAudio = null;
        let audioBlob = null;
        let currentTab = 'gallery';
        let audioContext = null;
        let audioBuffer = null;
        let audioSource = null;
        
        // متغیرهای جدید
        let uploadedMultipleImages = [];
        let currentSlideIndex = 0;
        let slideStartTime = 0;
        let isSlideshowMode = false;
        let showTextInVideo = true;
        let videoQuality = 1080;
        let fpsRate = 30;
        
        // تنظیمات اولیه
        videoCanvas.style.display = 'none';
        
        // لیست ۵۰ عکس واقعی از طبیعت و حیوانات
        const realNatureBackgrounds = [
            "https://images.unsplash.com/photo-1557050543-4d5f4e07ef46?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
            "https://images.unsplash.com/photo-1551085254-e96b210db58a?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
            "https://images.unsplash.com/photo-1546182990-dffeafbe841d?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
            "https://images.unsplash.com/photo-1564349683136-77e08dba1ef7?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
            "https://images.unsplash.com/photo-1564349683136-77e08dba1ef7?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
            "https://images.unsplash.com/photo-1559253664-ca249d4608c6?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
            "https://images.unsplash.com/photo-1518837695005-2083093ee35b?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
            "https://images.unsplash.com/photo-1546182990-dffeafbe841d?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
            "https://images.unsplash.com/photo-1557050543-4d5f4e07ef46?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
            "https://images.unsplash.com/photo-1551085254-e96b210db58a?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
            "https://images.unsplash.com/photo-1546182990-dffeafbe841d?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
            "https://images.unsplash.com/photo-1559253664-ca249d4608c6?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
            "https://images.unsplash.com/photo-1564349683136-77e08dba1ef7?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
            "https://images.unsplash.com/photo-1518837695005-2083093ee35b?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
            "https://images.unsplash.com/photo-1557050543-4d5f4e07ef46?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
            "https://images.unsplash.com/photo-1501854140801-50d01698950b?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
            "https://images.unsplash.com/photo-1439066615861-d1af74d74000?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
            "https://images.unsplash.com/photo-1441974231531-c6227db76b6e?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
            "https://images.unsplash.com/photo-1465146344425-f00d5f5c8f07?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
            "https://images.unsplash.com/photo-1506905925346-21bda4d32df4?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
            "https://images.unsplash.com/photo-1470071459604-3b5ec3a7fe05?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
            "https://images.unsplash.com/photo-1475924156734-496f6cac6ec1?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
            "https://images.unsplash.com/photo-1505142468610-359e7d316be0?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
            "https://images.unsplash.com/photo-1418065460487-3e41a6c84dc5?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
            "https://images.unsplash.com/photo-1476820865390-c52aeebb9891?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
            "https://images.unsplash.com/photo-1465146344425-f00d5f5c8f07?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
            "https://images.unsplash.com/photo-1501854140801-50d01698950b?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
            "https://images.unsplash.com/photo-1439066615861-d1af74d74000?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
            "https://images.unsplash.com/photo-1441974231531-c6227db76b6e?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
            "https://images.unsplash.com/photo-1506905925346-21bda4d32df4?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
            "https://images.unsplash.com/photo-1559827260-dc66d52bef19?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
            "https://images.unsplash.com/photo-1559827260-dc66d52bef19?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
            "https://images.unsplash.com/photo-1559827260-dc66d52bef19?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
            "https://images.unsplash.com/photo-1559827260-dc66d52bef19?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
            "https://images.unsplash.com/photo-1559827260-dc66d52bef19?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
            "https://images.unsplash.com/photo-1559827260-dc66d52bef19?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
            "https://images.unsplash.com/photo-1559827260-dc66d52bef19?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
            "https://images.unsplash.com/photo-1559827260-dc66d52bef19?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
            "https://images.unsplash.com/photo-1559827260-dc66d52bef19?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
            "https://images.unsplash.com/photo-1559827260-dc66d52bef19?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
            "https://images.unsplash.com/photo-1471899236350-e3016bf1e69e?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
            "https://images.unsplash.com/photo-1471899236350-e3016bf1e69e?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
            "https://images.unsplash.com/photo-1471899236350-e3016bf1e69e?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
            "https://images.unsplash.com/photo-1471899236350-e3016bf1e69e?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
            "https://images.unsplash.com/photo-1471899236350-e3016bf1e69e?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
            "https://images.unsplash.com/photo-1471899236350-e3016bf1e69e?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
            "https://images.unsplash.com/photo-1471899236350-e3016bf1e69e?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
            "https://images.unsplash.com/photo-1471899236350-e3016bf1e69e?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
            "https://images.unsplash.com/photo-1471899236350-e3016bf1e69e?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
            "https://images.unsplash.com/photo-1471899236350-e3016bf1e69e?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80"
        ];
        
        // اسلایدر مدت زمان
        durationSlider.addEventListener('input', function() {
            const value = parseInt(this.value);
            durationValue.textContent = value;
            updateTimerDisplay(0, value);
        });
        
        // اسلایدر مدت انتقال
        transitionDurationSlider.addEventListener('input', function() {
            const value = parseFloat(this.value);
            transitionDurationValue.textContent = value + ' ثانیه';
        });
        
        // کنترل کیفیت
        qualityBtns.forEach(btn => {
            btn.addEventListener('click', function() {
                qualityBtns.forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                videoQuality = parseInt(this.dataset.quality);
                
                // تنظیم کیفیت کانواس
                setCanvasQuality(videoQuality);
            });
        });
        
        // تنظیم کیفیت کانواس
        function setCanvasQuality(quality) {
            let width, height;
            
            switch(quality) {
                case 720:
                    width = 1280;
                    height = 720;
                    break;
                case 1080:
                    width = 1920;
                    height = 1080;
                    break;
                case 1440:
                    width = 2560;
                    height = 1440;
                    break;
                case 2160:
                    width = 3840;
                    height = 2160;
                    break;
                default:
                    width = 1920;
                    height = 1080;
            }
            
            videoCanvas.width = width;
            videoCanvas.height = height;
            videoCanvas.style.width = '100%';
            videoCanvas.style.height = 'auto';
        }
        
        // کنترل نمایش متن
        textToggle.addEventListener('click', function() {
            showTextInVideo = !showTextInVideo;
            this.classList.toggle('active');
            if (showTextInVideo) {
                this.innerHTML = '<i class="fas fa-font"></i> نمایش متن در ویدیو';
            } else {
                this.innerHTML = '<i class="fas fa-eye-slash"></i> مخفی کردن متن در ویدیو';
            }
        });
        
        // آپلود چند عکس
        multiUploadTrigger.addEventListener('click', () => {
            multipleImagesInput.click();
        });
        
        multipleImagesInput.addEventListener('change', async function(e) {
            const files = Array.from(e.target.files);
            const maxFiles = 20;
            
            if (files.length > maxFiles) {
                alert(`حداکثر ${maxFiles} عکس می‌توانید آپلود کنید`);
                return;
            }
            
            for (const file of files) {
                if (file.size > 5 * 1024 * 1024) {
                    alert(`فایل ${file.name} بیش از ۵ مگابایت است`);
                    return;
                }
            }
            
            if (uploadedMultipleImages.length + files.length > maxFiles) {
                const confirmDelete = confirm(`شما ${uploadedMultipleImages.length} عکس دارید. آیا می‌خواهید عکس‌های قبلی حذف شوند؟`);
                if (confirmDelete) {
                    uploadedMultipleImages = [];
                    multipleImagesContainer.innerHTML = '';
                } else {
                    return;
                }
            }
            
            for (const file of files) {
                try {
                    const img = await loadImage(file);
                    uploadedMultipleImages.push({
                        file: file,
                        image: img,
                        name: file.name
                    });
                    
                    addImageToContainer(img, uploadedMultipleImages.length - 1);
                } catch (error) {
                    console.error('خطا در بارگذاری عکس:', error);
                }
            }
            
            isSlideshowMode = uploadedMultipleImages.length > 0;
            
            if (isSlideshowMode) {
                selectedBgInfo.innerHTML = `<i class="fas fa-sliders-h"></i> حالت اسلایدشو فعال (${uploadedMultipleImages.length} عکس)`;
                quickPreview();
            }
            
            multipleImagesInput.value = '';
        });
        
        function loadImage(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const img = new Image();
                    img.onload = () => resolve(img);
                    img.onerror = reject;
                    img.src = e.target.result;
                };
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }
        
        function addImageToContainer(img, index) {
            const item = document.createElement('div');
            item.className = 'image-item';
            item.dataset.index = index;
            
            const canvas = document.createElement('canvas');
            canvas.width = 70;
            canvas.height = 70;
            const ctx = canvas.getContext('2d');
            ctx.drawImage(img, 0, 0, 70, 70);
            
            const imgElement = document.createElement('img');
            imgElement.src = canvas.toDataURL();
            imgElement.alt = `عکس ${index + 1}`;
            
            const removeBtn = document.createElement('button');
            removeBtn.className = 'image-remove';
            removeBtn.innerHTML = '<i class="fas fa-times"></i>';
            removeBtn.onclick = (e) => {
                e.stopPropagation();
                removeMultipleImage(index);
            };
            
            item.appendChild(imgElement);
            item.appendChild(removeBtn);
            
            multipleImagesContainer.appendChild(item);
        }
        
        function removeMultipleImage(index) {
            uploadedMultipleImages.splice(index, 1);
            multipleImagesContainer.innerHTML = '';
            uploadedMultipleImages.forEach((img, i) => addImageToContainer(img.image, i));
            
            isSlideshowMode = uploadedMultipleImages.length > 0;
            
            if (!isSlideshowMode) {
                selectedBgInfo.innerHTML = '<i class="fas fa-images"></i> لطفا عکس یا پس‌زمینه انتخاب کنید';
            } else {
                selectedBgInfo.innerHTML = `<i class="fas fa-sliders-h"></i> حالت اسلایدشو فعال (${uploadedMultipleImages.length} عکس)`;
            }
        }
        
        // بارگذاری عکس‌های واقعی
        function loadRealNatureBackgrounds() {
            selectedBgInfo.innerHTML = '<i class="fas fa-spinner fa-spin"></i> در حال بارگذاری ۵۰ عکس واقعی از طبیعت و حیوانات...';
            
            realNatureBackgrounds.forEach((url, index) => {
                const img = new Image();
                img.crossOrigin = "anonymous";
                img.src = url + "&fit=crop&w=400&h=300&q=85";
                
                img.onload = () => {
                    loadedImages++;
                    if (loadedImages === 1 && currentTab === 'gallery') {
                        selectedBackground = img;
                        updateSelectedBgInfo(`عکس ۱ از طبیعت`);
                    }
                    
                    if (loadedImages === realNatureBackgrounds.length) {
                        selectedBgInfo.innerHTML = `<i class="fas fa-check-circle"></i> ${loadedImages} عکس واقعی بارگذاری شد`;
                    }
                };
                
                img.onerror = () => {
                    createNatureFallbackImage(index);
                    loadedImages++;
                    
                    if (loadedImages === 1 && currentTab === 'gallery') {
                        selectedBackground = backgroundImages[index];
                        updateSelectedBgInfo(`عکس ۱ از طبیعت`);
                    }
                    
                    if (loadedImages === realNatureBackgrounds.length) {
                        selectedBgInfo.innerHTML = `<i class="fas fa-check-circle"></i> ${loadedImages} عکس واقعی بارگذاری شد`;
                    }
                };
                
                backgroundImages.push(img);
                
                const thumb = document.createElement('img');
                thumb.className = 'background-thumb';
                thumb.src = img.src;
                thumb.alt = `عکس طبیعت ${index + 1}`;
                thumb.dataset.index = index;
                thumb.title = `عکس ${index + 1}`;
                
                thumb.addEventListener('click', () => {
                    if (currentTab !== 'gallery') return;
                    
                    document.querySelectorAll('.background-thumb').forEach(t => {
                        t.classList.remove('selected');
                    });
                    
                    thumb.classList.add('selected');
                    
                    selectedBackground = backgroundImages[index];
                    userUploadedImage = null;
                    isSlideshowMode = false;
                    updateSelectedBgInfo(`عکس ${index + 1} از طبیعت`);
                    
                    if (!isGenerating) {
                        quickPreview();
                    }
                });
                
                backgroundGallery.appendChild(thumb);
                
                if (index === 0) {
                    thumb.classList.add('selected');
                }
            });
        }
        
        function createNatureFallbackImage(index) {
            const canvas = document.createElement('canvas');
            canvas.width = 800;
            canvas.height = 450;
            const ctx = canvas.getContext('2d');
            
            let gradient;
            
            if (index < 15) {
                gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
                gradient.addColorStop(0, '#8B4513');
                gradient.addColorStop(0.5, '#A0522D');
                gradient.addColorStop(1, '#8B4513');
            } else if (index < 30) {
                gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
                gradient.addColorStop(0, '#2E8B57');
                gradient.addColorStop(0.5, '#3CB371');
                gradient.addColorStop(1, '#2E8B57');
            } else if (index < 40) {
                gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
                gradient.addColorStop(0, '#1E90FF');
                gradient.addColorStop(0.5, '#00BFFF');
                gradient.addColorStop(1, '#1E90FF');
            } else {
                gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
                gradient.addColorStop(0, '#FF69B4');
                gradient.addColorStop(0.5, '#FFB6C1');
                gradient.addColorStop(1, '#FF69B4');
            }
            
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
            ctx.font = 'bold 40px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            
            let text = '';
            if (index < 15) text = 'حیات وحش';
            else if (index < 30) text = 'طبیعت';
            else if (index < 40) text = 'دریایی';
            else text = 'گلها';
            
            ctx.fillText(text, canvas.width/2, canvas.height/2);
            
            const img = new Image();
            img.src = canvas.toDataURL();
            backgroundImages[index] = img;
            
            const thumb = backgroundGallery.querySelector(`img[data-index="${index}"]`);
            if (thumb) {
                thumb.src = img.src;
            }
            
            return img;
        }
        
        function updateSelectedBgInfo(info) {
            selectedBgInfo.innerHTML = `<i class="fas fa-check-circle"></i> ${info}`;
        }
        
        function quickPreview() {
            if (isGenerating) return;
            
            const ctx = videoCanvas.getContext('2d');
            const width = videoCanvas.width;
            const height = videoCanvas.height;
            
            if (isSlideshowMode && uploadedMultipleImages.length > 0) {
                ctx.drawImage(uploadedMultipleImages[0].image, 0, 0, width, height);
            } else if (userUploadedImage) {
                ctx.drawImage(userUploadedImage, 0, 0, width, height);
            } else if (selectedBackground) {
                ctx.drawImage(selectedBackground, 0, 0, width, height);
            }
            
            ctx.fillStyle = 'rgba(0, 0, 0, 0.4)';
            ctx.fillRect(0, 0, width, height);
            
            ctx.font = 'bold 36px "Segoe UI"';
            ctx.fillStyle = '#ffffff';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText('پیش‌نمایش', width / 2, height / 2);
            
            canvasPlaceholder.style.display = 'none';
            videoCanvas.style.display = 'block';
        }
        
        // مدیریت تب‌ها
        tabButtons.forEach(button => {
            button.addEventListener('click', () => {
                const tabId = button.getAttribute('data-tab');
                
                tabButtons.forEach(btn => btn.classList.remove('active'));
                tabContents.forEach(content => content.classList.remove('active'));
                
                button.classList.add('active');
                document.getElementById(`${tabId}-tab`).classList.add('active');
                
                currentTab = tabId;
                
                if (tabId === 'upload' && userUploadedImage) {
                    selectedBackground = userUploadedImage;
                    isSlideshowMode = false;
                    updateSelectedBgInfo('عکس آپلود شده');
                    quickPreview();
                } else if (tabId === 'gallery' && backgroundImages.length > 0) {
                    const firstThumb = backgroundGallery.querySelector('.background-thumb');
                    if (firstThumb) {
                        const index = parseInt(firstThumb.dataset.index);
                        selectedBackground = backgroundImages[index];
                        userUploadedImage = null;
                        isSlideshowMode = false;
                        
                        document.querySelectorAll('.background-thumb').forEach(t => {
                            t.classList.remove('selected');
                        });
                        firstThumb.classList.add('selected');
                        
                        updateSelectedBgInfo(`عکس ۱ از طبیعت`);
                        quickPreview();
                    }
                }
            });
        });
        
        // مدیریت آپلود عکس
        uploadTrigger.addEventListener('click', () => {
            uploadInput.click();
        });
        
        uploadInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            if (!file.type.match('image.*')) {
                alert('لطفا یک فایل تصویری انتخاب کنید (JPG, PNG, WebP)');
                return;
            }
            
            if (file.size > 5 * 1024 * 1024) {
                alert('حجم فایل باید کمتر از ۵ مگابایت باشد');
                return;
            }
            
            const reader = new FileReader();
            
            reader.onload = function(event) {
                const img = new Image();
                img.onload = function() {
                    userUploadedImage = img;
                    selectedBackground = img;
                    isSlideshowMode = false;
                    
                    uploadedImage.src = event.target.result;
                    uploadFileName.textContent = file.name;
                    uploadPreview.style.display = 'block';
                    
                    updateSelectedBgInfo('عکس آپلود شده');
                    
                    document.querySelector('[data-tab="upload"]').click();
                    
                    quickPreview();
                };
                img.src = event.target.result;
            };
            
            reader.readAsDataURL(file);
        });
        
        removeUpload.addEventListener('click', function() {
            userUploadedImage = null;
            uploadInput.value = '';
            uploadPreview.style.display = 'none';
            
            document.querySelector('[data-tab="gallery"]').click();
            
            if (backgroundImages.length > 0) {
                const firstThumb = backgroundGallery.querySelector('.background-thumb');
                if (firstThumb) {
                    const index = parseInt(firstThumb.dataset.index);
                    selectedBackground = backgroundImages[index];
                    
                    document.querySelectorAll('.background-thumb').forEach(t => {
                        t.classList.remove('selected');
                    });
                    firstThumb.classList.add('selected');
                    
                    updateSelectedBgInfo(`عکس ۱ از طبیعت`);
                    quickPreview();
                }
            }
        });
        
        // مدیریت آپلود صدا
        audioTrigger.addEventListener('click', () => {
            audioInput.click();
        });
        
        audioInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            if (!file.type.match('audio.*')) {
                alert('لطفا یک فایل صوتی انتخاب کنید (MP3, WAV, OGG)');
                return;
            }
            
            if (file.size > 10 * 1024 * 1024) {
                alert('حجم فایل باید کمتر از ۱۰ مگابایت باشد');
                return;
            }
            
            const reader = new FileReader();
            
            reader.onload = function(event) {
                audioBlob = new Blob([event.target.result], { type: file.type });
                
                uploadedAudio.src = URL.createObjectURL(audioBlob);
                audioFileName.textContent = file.name;
                audioPreview.style.display = 'block';
                
                userUploadedAudio = file;
            };
            
            reader.readAsArrayBuffer(file);
        });
        
        removeAudio.addEventListener('click', function() {
            userUploadedAudio = null;
            audioBlob = null;
            audioInput.value = '';
            audioPreview.style.display = 'none';
            uploadedAudio.src = '';
        });
        
        // تابع برای قالب‌بندی زمان
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }
        
        function updateTimerDisplay(elapsed, total) {
            timer.textContent = `${formatTime(elapsed)} / ${formatTime(total)}`;
        }
        
        // تابع برای رسم متن با کیفیت بالا
        function drawHighQualityText(ctx, text, options) {
            const {
                width,
                height,
                fontSize,
                textColor,
                textEffect,
                progress,
                currentImage
            } = options;
            
            // کشیدن پس‌زمینه با کیفیت بالا
            if (isSlideshowMode && currentImage) {
                ctx.save();
                ctx.imageSmoothingEnabled = true;
                ctx.imageSmoothingQuality = 'high';
                ctx.drawImage(currentImage, 0, 0, width, height);
                ctx.restore();
            } else if (selectedBackground && selectedBackground.complete) {
                ctx.save();
                ctx.imageSmoothingEnabled = true;
                ctx.imageSmoothingQuality = 'high';
                ctx.drawImage(selectedBackground, 0, 0, width, height);
                ctx.restore();
            } else {
                ctx.fillStyle = '#000';
                ctx.fillRect(0, 0, width, height);
            }
            
            // اضافه کردن لایه تاریکی برای خوانایی بهتر متن
            if (showTextInVideo && text.trim().length > 0) {
                ctx.fillStyle = 'rgba(0, 0, 0, 0.5)';
                ctx.fillRect(0, 0, width, height);
            }
            
            // اگر متن نمایش داده نشود یا متن خالی باشد، فقط عکس نمایش داده شود
            if (!showTextInVideo || text.trim().length === 0) {
                return;
            }
            
            // محاسبه تعداد کاراکترهای نمایش داده شده
            const totalChars = text.length;
            const charsToShow = Math.floor(totalChars * progress);
            const visibleText = text.substring(0, charsToShow);
            
            // تنظیمات فونت با کیفیت بالا
            ctx.font = `bold ${fontSize}px 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif`;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            
            // اعمال افکت‌های متن با کیفیت بالا
            switch(textEffect) {
                case 'glow':
                    ctx.shadowColor = textColor;
                    ctx.shadowBlur = 30;
                    ctx.shadowOffsetX = 0;
                    ctx.shadowOffsetY = 0;
                    ctx.fillStyle = textColor;
                    break;
                    
                case 'gradient':
                    const gradient = ctx.createLinearGradient(
                        width/2 - width * 0.3, 
                        height/2 - 50, 
                        width/2 + width * 0.3, 
                        height/2 + 50
                    );
                    gradient.addColorStop(0, '#ff6b6b');
                    gradient.addColorStop(0.3, '#ffd93d');
                    gradient.addColorStop(0.6, '#4ecdc4');
                    gradient.addColorStop(1, '#45b7d1');
                    ctx.fillStyle = gradient;
                    ctx.shadowColor = 'rgba(0, 0, 0, 0.9)';
                    ctx.shadowBlur = 15;
                    ctx.shadowOffsetX = 3;
                    ctx.shadowOffsetY = 3;
                    break;
                    
                case 'outline':
                    ctx.strokeStyle = '#000';
                    ctx.lineWidth = 4;
                    ctx.lineJoin = 'round';
                    ctx.fillStyle = textColor;
                    ctx.shadowColor = 'transparent';
                    break;
                    
                case '3d':
                    ctx.fillStyle = textColor;
                    ctx.shadowColor = 'rgba(0, 0, 0, 0.5)';
                    ctx.shadowBlur = 10;
                    ctx.shadowOffsetX = 4;
                    ctx.shadowOffsetY = 4;
                    break;
                    
                default: // shadow
                    ctx.fillStyle = textColor;
                    ctx.shadowColor = 'rgba(0, 0, 0, 0.8)';
                    ctx.shadowBlur = 12;
                    ctx.shadowOffsetX = 3;
                    ctx.shadowOffsetY = 3;
                    break;
            }
            
            // شکستن خطوط متن
            const maxWidth = width * 0.85;
            const lineHeight = fontSize * 1.6;
            
            const lines = [];
            let currentLine = '';
            
            for (const word of visibleText.split(' ')) {
                const testLine = currentLine ? `${currentLine} ${word}` : word;
                const metrics = ctx.measureText(testLine);
                
                if (metrics.width > maxWidth && currentLine) {
                    lines.push(currentLine);
                    currentLine = word;
                } else {
                    currentLine = testLine;
                }
            }
            
            if (currentLine) {
                lines.push(currentLine);
            }
            
            // رسم خطوط متن با کیفیت بالا
            const startY = height / 2 - (lines.length - 1) * lineHeight / 2;
            
            lines.forEach((line, index) => {
                const y = startY + index * lineHeight;
                
                if (textEffect === 'outline') {
                    ctx.strokeText(line, width / 2, y);
                    ctx.fillText(line, width / 2, y);
                } else {
                    ctx.fillText(line, width / 2, y);
                }
            });
            
            // بازنشانی تنظیمات سایه
            ctx.shadowColor = 'transparent';
            ctx.shadowBlur = 0;
            ctx.shadowOffsetX = 0;
            ctx.shadowOffsetY = 0;
            ctx.strokeStyle = 'transparent';
        }
        
        // تابع ایجاد ویدیو با کیفیت بالا
        async function createHighQualityVideo() {
            if (isGenerating) return;
            
            if (!selectedBackground && !userUploadedImage && uploadedMultipleImages.length === 0) {
                alert('لطفا یک پس‌زمینه انتخاب کنید، عکس خود را آپلود کنید یا چند عکس برای اسلایدشو آپلود کنید.');
                return;
            }
            
            isGenerating = true;
            loadingIndicator.style.display = 'block';
            loadingText.textContent = 'در حال ساخت ویدیو با کیفیت بالا...';
            loadingDetails.textContent = 'این فرآیند ممکن است چند لحظه طول بکشد';
            generateBtn.disabled = true;
            canvasPlaceholder.style.display = 'none';
            videoCanvas.style.display = 'block';
            progressBarContainer.style.display = 'block';
            
            // دریافت تنظیمات
            const text = textInput.value || "";
            const fontSize = parseInt(fontSizeSelect.value);
            const textColor = textColorSelect.value;
            const textEffect = textEffectSelect.value;
            const duration = parseInt(durationSlider.value);
            const transitionDuration = parseFloat(transitionDurationSlider.value);
            fpsRate = parseInt(fpsRateSelect.value);
            
            // ابعاد کانواس بر اساس کیفیت
            const width = videoCanvas.width;
            const height = videoCanvas.height;
            
            try {
                loadingText.textContent = 'در حال آماده‌سازی با کیفیت بالا...';
                progressFill.style.width = '5%';
                
                // ایجاد MediaStream از canvas با کیفیت بالا
                const canvasStream = videoCanvas.captureStream(fpsRate);
                
                // بهینه‌سازی کیفیت Canvas
                ctx.imageSmoothingEnabled = true;
                ctx.imageSmoothingQuality = 'high';
                ctx.textRendering = 'optimizeLegibility';
                
                recordedChunks = [];
                
                // اگر صدا وجود دارد، آن را به stream اضافه کن
                let finalStream = canvasStream;
                
                if (userUploadedAudio && audioBlob) {
                    loadingText.textContent = 'در حال ترکیب صدا با کیفیت بالا...';
                    progressFill.style.width = '15%';
                    
                    const arrayBuffer = await audioBlob.arrayBuffer();
                    
                    audioContext = new (window.AudioContext || window.webkitAudioContext)({
                        sampleRate: 48000 // کیفیت صدا بالا
                    });
                    
                    audioBuffer = await audioContext.decodeAudioData(arrayBuffer);
                    
                    const audioDestination = audioContext.createMediaStreamDestination();
                    audioSource = audioContext.createBufferSource();
                    audioSource.buffer = audioBuffer;
                    
                    // افزودن فیلترهای صوتی برای کیفیت بهتر
                    const gainNode = audioContext.createGain();
                    gainNode.gain.value = 1.0;
                    
                    audioSource.connect(gainNode);
                    gainNode.connect(audioDestination);
                    
                    const audioTrack = audioDestination.stream.getAudioTracks()[0];
                    const videoTrack = canvasStream.getVideoTracks()[0];
                    
                    finalStream = new MediaStream([videoTrack, audioTrack]);
                    
                    if (audioBuffer.duration < duration) {
                        audioSource.loop = true;
                    }
                }
                
                // پیدا کردن بهترین کدک ویدیویی
                let mimeType;
                let videoBitsPerSecond;
                
                if (MediaRecorder.isTypeSupported('video/mp4;codecs=avc1.640028')) {
                    // H.264 High Profile
                    mimeType = 'video/mp4;codecs=avc1.640028';
                    videoBitsPerSecond = videoQuality >= 1440 ? 8000000 : 5000000;
                } else if (MediaRecorder.isTypeSupported('video/webm;codecs=vp9')) {
                    // VP9 (کیفیت بهتر)
                    mimeType = 'video/webm;codecs=vp9';
                    videoBitsPerSecond = videoQuality >= 1440 ? 10000000 : 6000000;
                } else if (MediaRecorder.isTypeSupported('video/webm;codecs=vp8')) {
                    // VP8
                    mimeType = 'video/webm;codecs=vp8';
                    videoBitsPerSecond = 4000000;
                } else {
                    mimeType = 'video/webm';
                    videoBitsPerSecond = 3000000;
                }
                
                loadingDetails.textContent = `استفاده از کدک: ${mimeType.includes('avc1') ? 'H.264 (کیفیت بالا)' : 'VP9 (کیفیت بهینه)'}`;
                progressFill.style.width = '25%';
                
                // تنظیمات MediaRecorder با کیفیت بالا
                const recorderOptions = { 
                    mimeType,
                    videoBitsPerSecond,
                    audioBitsPerSecond: 192000 // کیفیت صدا 192kbps
                };
                
                mediaRecorder = new MediaRecorder(finalStream, recorderOptions);
                
                mediaRecorder.ondataavailable = (event) => {
                    if (event.data.size > 0) {
                        recordedChunks.push(event.data);
                    }
                };
                
                mediaRecorder.onstop = () => {
                    const blob = new Blob(recordedChunks, { 
                        type: mediaRecorder.mimeType 
                    });
                    const url = URL.createObjectURL(blob);
                    
                    // فعال کردن دکمه دانلود
                    downloadBtn.disabled = false;
                    downloadBtn.onclick = () => {
                        const a = document.createElement('a');
                        a.href = url;
                        const extension = mediaRecorder.mimeType.includes('mp4') ? 'mp4' : 'webm';
                        const qualityLabel = videoQuality === 2160 ? '4K' : videoQuality === 1440 ? '2K' : `${videoQuality}p`;
                        a.download = `ویدیو-${qualityLabel}-${Date.now()}.${extension}`;
                        document.body.appendChild(a);
                        a.click();
                        document.body.removeChild(a);
                        setTimeout(() => URL.revokeObjectURL(url), 1000);
                    };
                    
                    isGenerating = false;
                    loadingIndicator.style.display = 'none';
                    generateBtn.disabled = false;
                    progressBarContainer.style.display = 'none';
                    
                    // پاکسازی منابع
                    if (audioSource) {
                        audioSource.stop();
                        audioSource.disconnect();
                    }
                    if (audioContext && audioContext.state !== 'closed') {
                        audioContext.close();
                    }
                    
                    loadingText.textContent = 'ویدیو با موفقیت ساخته شد!';
                    loadingDetails.textContent = 'حالا می‌توانید ویدیو را دانلود کنید';
                };
                
                // شروع ضبط
                mediaRecorder.start(1000); // ارسال داده هر 1 ثانیه
                startTime = Date.now();
                
                // شروع پخش صدا (اگر وجود دارد)
                if (audioSource) {
                    audioSource.start();
                }
                
                // محاسبه پیشرفت
                let frameCount = 0;
                const totalFrames = duration * fpsRate;
                const transitionFrames = transitionDuration * fpsRate;
                
                // تابع انیمیشن با کیفیت بالا
                function animate() {
                    const elapsed = Date.now() - startTime;
                    const progress = Math.min(elapsed / (duration * 1000), 1);
                    
                    // به‌روزرسانی تایمر
                    updateTimerDisplay(elapsed / 1000, duration);
                    
                    // به‌روزرسانی نوار پیشرفت
                    frameCount++;
                    const processingProgress = Math.min((frameCount / totalFrames) * 100, 100);
                    progressFill.style.width = processingProgress + '%';
                    
                    // انتخاب تصویر برای نمایش (اسلایدشو)
                    let currentImage = null;
                    if (isSlideshowMode && uploadedMultipleImages.length > 0) {
                        const totalSlides = uploadedMultipleImages.length;
                        const currentFrame = Math.floor(elapsed / 1000 * fpsRate);
                        const slideIndex = Math.floor(currentFrame / transitionFrames) % totalSlides;
                        currentImage = uploadedMultipleImages[slideIndex].image;
                    }
                    
                    // رسم با کیفیت بالا
                    drawHighQualityText(ctx, text, {
                        width,
                        height,
                        fontSize,
                        textColor,
                        textEffect,
                        progress,
                        currentImage
                    });
                    
                    if (progress < 1) {
                        // استفاده از requestAnimationFrame با تنظیم FPS
                        setTimeout(() => {
                            animationId = requestAnimationFrame(animate);
                        }, 1000 / fpsRate);
                    } else {
                        cancelAnimationFrame(animationId);
                        
                        // توقف صدا
                        if (audioSource) {
                            audioSource.stop();
                        }
                        
                        // توقف ضبط با تأخیر برای اطمینان از کامل شدن
                        setTimeout(() => {
                            if (mediaRecorder.state === 'recording') {
                                mediaRecorder.stop();
                                updateTimerDisplay(duration, duration);
                                loadingText.textContent = 'ویدیو با کیفیت بالا ساخته شد!';
                                loadingDetails.textContent = 'در حال ذخیره‌سازی فایل نهایی...';
                            }
                        }, 1000);
                    }
                }
                
                // شروع انیمیشن
                animate();
                
            } catch (error) {
                console.error('خطا در ساخت ویدیو:', error);
                loadingText.textContent = 'خطا در ساخت ویدیو. لطفا دوباره تلاش کنید.';
                loadingDetails.textContent = error.message;
                
                setTimeout(() => {
                    loadingIndicator.style.display = 'none';
                    isGenerating = false;
                    generateBtn.disabled = false;
                    progressBarContainer.style.display = 'none';
                }, 3000);
                
                // پاکسازی در صورت خطا
                if (audioSource) {
                    audioSource.stop();
                    audioSource.disconnect();
                }
                if (audioContext && audioContext.state !== 'closed') {
                    audioContext.close();
                }
            }
        }
        
        // رویدادها
        generateBtn.addEventListener('click', createHighQualityVideo);
        
        // بارگذاری عکس‌های طبیعت واقعی
        loadRealNatureBackgrounds();
        
        // پیش‌نمایش اولیه
        setTimeout(() => {
            if (!isGenerating && selectedBackground) {
                quickPreview();
            }
        }, 1500);
        
        // جلوگیری از زوم روی موبایل
        document.addEventListener('touchstart', function(e) {
            if (e.touches.length > 1) {
                e.preventDefault();
            }
        }, { passive: false });
        
        let lastTouchEnd = 0;
        document.addEventListener('touchend', function(e) {
            const now = Date.now();
            if (now - lastTouchEnd <= 300) {
                e.preventDefault();
            }
            lastTouchEnd = now;
        }, false);
        
        // به‌روزرسانی اولیه تایمر
        updateTimerDisplay(0, 15);
        
        // تنظیم کیفیت اولیه
        setCanvasQuality(1080);
    </script>
</body>
</html>